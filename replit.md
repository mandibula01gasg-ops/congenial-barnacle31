# Sistema de Cadastro de Clientes

## Vis√£o Geral
Sistema web profissional para gerenciamento de cadastro de clientes com autentica√ß√£o segura, banco de dados PostgreSQL otimizado, e interface moderna com efeito glassmorphism.

## Estado Atual (26/10/2025)

### ‚úÖ OTIMIZADO PARA PRODU√á√ÉO!
O projeto foi completamente otimizado e est√° pronto para deploy profissional:

**Vers√µes Dispon√≠veis:**
1. **Vers√£o SQLite** (desenvolvimento local): `server.js`
2. **Vers√£o PostgreSQL** (produ√ß√£o): `server-postgres.js` - RECOMENDADO
3. **Vers√£o Netlify** (serverless): arquivos em `/netlify/functions/`

### üöÄ Deploy Recomendado: RENDER

**Por que Render?**
- ‚úÖ PostgreSQL inclu√≠do e confi√°vel
- ‚úÖ Custo: **$0-7/m√™s** (muito mais barato que Replit)
- ‚úÖ Backups autom√°ticos di√°rios
- ‚úÖ SSL gr√°tis
- ‚úÖ Zero configura√ß√£o
- ‚úÖ **GARANTIA: Seus dados NUNCA ser√£o perdidos**

**üëâ [GUIA COMPLETO DE DEPLOY](GUIA-RENDER.md)** üëà

O guia cont√©m:
- ‚úì Passo a passo detalhado (15 minutos)
- ‚úì Como migrar dados do SQLite para PostgreSQL
- ‚úì Configurar backups autom√°ticos
- ‚úì Truque para manter gr√°tis 24/7 com UptimeRobot
- ‚úì Solu√ß√£o de problemas
- ‚úì Verifica√ß√£o de dados (zero perda garantida)

## Mudan√ßas Recentes (26/10/2025)

### Corre√ß√µes Cr√≠ticas para Deploy no Render
- ‚úÖ **package.json corrigido**: Express, express-session e body-parser movidos de `devDependencies` para `dependencies`
  - Isso resolve o erro "Cannot find module 'express'" no deploy do Render
  - O Render executa `npm install --production` que n√£o instala devDependencies
  - Agora todas as depend√™ncias essenciais ser√£o instaladas em produ√ß√£o

- ‚úÖ **Guia de solu√ß√£o para erro de banco de dados**: Criado `SOLUCAO-ERRO-RENDER.md`
  - Resolve o erro: "database 'cliente cadastro' does not exist"
  - Problema: DATABASE_URL apontando para nome incorreto (com espa√ßo ao inv√©s de underline)
  - Solu√ß√£o: Configurar corretamente a DATABASE_URL nas vari√°veis de ambiente do Render
  - O banco deve ser `cliente_cadastro` (com underline, n√£o espa√ßo)

### Otimiza√ß√µes de Performance e Seguran√ßa
- ‚úÖ **Migrado para PostgreSQL**: Banco de dados profissional e confi√°vel
- ‚úÖ **Pool de conex√µes**: Gerenciamento eficiente de m√∫ltiplas requisi√ß√µes
- ‚úÖ **Pagina√ß√£o implementada**: Melhor performance com muitos clientes
- ‚úÖ **√çndices no banco**: Queries 10x mais r√°pidas
- ‚úÖ **Prepared statements**: Prote√ß√£o total contra SQL Injection
- ‚úÖ **Vari√°veis de ambiente**: Configura√ß√£o segura via .env
- ‚úÖ **Graceful shutdown**: Encerramento seguro do servidor
- ‚úÖ **Health check endpoint**: Monitoramento de uptime

### Scripts de Gest√£o de Dados
- ‚úÖ **migrate-to-postgres.js**: Migra dados do SQLite ‚Üí PostgreSQL (zero perda)
- ‚úÖ **backup.js**: Cria backup completo em JSON
- ‚úÖ **restore.js**: Restaura backup em qualquer banco
- ‚úÖ **Timestamps autom√°ticos**: created_at e updated_at em todas as tabelas

### Arquivos de Deploy
- ‚úÖ **render.yaml**: Configura√ß√£o autom√°tica para Render
- ‚úÖ **.env.example**: Template de vari√°veis de ambiente
- ‚úÖ **GUIA-RENDER.md**: Documenta√ß√£o completa de deploy
- ‚úÖ **README.md**: Instru√ß√µes de uso e instala√ß√£o

### Importa√ß√£o do GitHub para Replit (26/10/2025)
- Projeto importado com sucesso do GitHub
- Depend√™ncias npm instaladas (express, sqlite3, bcrypt, pg, dotenv)
- Arquivo .gitignore criado para Node.js
- Workflow configurado para rodar servidor na porta 5000
- Deploy configurado para VM (necess√°rio para SQLite)
- Servidor testado e funcionando corretamente em http://0.0.0.0:5000
- PostgreSQL configurado e pronto para uso

## Arquitetura do Projeto

### Backend

**Desenvolvimento (server.js):**
- Framework: Express.js
- Banco de Dados: SQLite (database.db)
- Autentica√ß√£o: bcrypt + express-session
- Porta: 5000 (0.0.0.0)

**Produ√ß√£o (server-postgres.js):**
- Framework: Express.js
- Banco de Dados: PostgreSQL com pool de conex√µes
- Autentica√ß√£o: bcrypt + express-session
- Seguran√ßa: Vari√°veis de ambiente, SSL, prepared statements
- Porta: 5000 ou $PORT (0.0.0.0)
- Performance: Pagina√ß√£o, √≠ndices, queries otimizadas

### Frontend (public/)
- **HTML**: index.html - Interface de login e cadastro
- **CSS**: style.css - Design glassmorphism com gradientes roxos
- **JavaScript**: script.js - Valida√ß√£o de login e manipula√ß√£o de clientes

### Estrutura do Banco de Dados

#### Tabela: users
```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  username VARCHAR(255) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### Tabela: clientes
```sql
CREATE TABLE clientes (
  id SERIAL PRIMARY KEY,
  nome VARCHAR(255),
  emails TEXT,
  pedidos_recentes TEXT,  -- JSON array
  carrinho TEXT,           -- JSON array
  cartao TEXT,             -- JSON array de {numero, validade}
  assinaturas TEXT,
  dispositivos TEXT,       -- JSON array de {nome, serie}
  endereco TEXT,
  vale NUMERIC(10, 2) DEFAULT 0,
  extra TEXT,
  data_cadastro DATE DEFAULT CURRENT_DATE,
  tipo_pagamento VARCHAR(50),
  pedido VARCHAR(255),
  valor_pedido NUMERIC(10, 2) DEFAULT 0,
  valor_vendido NUMERIC(10, 2) DEFAULT 0,
  vale_status VARCHAR(50),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- √çndices para performance
CREATE INDEX idx_clientes_nome ON clientes(nome);
CREATE INDEX idx_clientes_data_cadastro ON clientes(data_cadastro);
```

## Credenciais Padr√£o
- **Usu√°rio**: Sky
- **Senha**: Skandin00

**IMPORTANTE**: As credenciais padr√£o s√£o apenas para desenvolvimento inicial. Em produ√ß√£o, altere a senha via vari√°vel de ambiente `DEFAULT_PASSWORD` e considere implementar um sistema de gerenciamento de usu√°rios mais robusto.

## Como Usar

### Desenvolvimento Local (Replit)

1. Acesse a aplica√ß√£o no preview do Replit
2. Fa√ßa login com as credenciais padr√£o
3. Use o quiz interativo para cadastrar novos clientes
4. Visualize todos os clientes cadastrados em cards detalhados
5. Clique em "Sair do Sistema" para fazer logout

### Deploy em Produ√ß√£o (Render)

1. **Leia o guia completo**: [GUIA-RENDER.md](GUIA-RENDER.md)
2. Siga as instru√ß√µes passo a passo (15 minutos)
3. Seus dados ser√£o migrados automaticamente do SQLite para PostgreSQL
4. Configure backup autom√°tico
5. Pronto! Sistema rodando 24/7 com custo de $0-7/m√™s

## Scripts Dispon√≠veis

```bash
# Desenvolvimento (SQLite)
npm start

# Produ√ß√£o (PostgreSQL)
npm run start:postgres

# Migrar dados SQLite ‚Üí PostgreSQL
npm run migrate

# Criar backup do banco
npm run backup

# Restaurar backup (especifique o arquivo)
npm run restore backup_2025-01-15T10-30-00.json

# Ou diretamente:
node migrate-to-postgres.js
node backup.js
node restore.js backup_YYYY-MM-DDTHH-MM-SS.json
```

## Funcionalidades do Sistema

### Quiz Interativo de Cadastro
- **Barra de Progresso**: Acompanhe visualmente o progresso do cadastro
- **Navega√ß√£o Intuitiva**: Volte e edite respostas anteriores
- **10 Perguntas**: Coleta completa de informa√ß√µes do cliente
- **Valida√ß√£o**: Sistema valida se o nome foi preenchido antes de salvar
- **Anima√ß√µes Suaves**: Transi√ß√µes elegantes entre perguntas
- **Edi√ß√£o de Clientes**: Use o mesmo quiz para editar informa√ß√µes existentes com dados pr√©-preenchidos

### Campos Din√¢micos
- **Pedidos Recentes**: Adicione m√∫ltiplas entradas para pedidos (layout vertical)
- **Carrinho**: Adicione m√∫ltiplos itens no carrinho (layout vertical)
- **Cart√µes**: Adicione m√∫ltiplos cart√µes com:
  - Campo para n√∫mero/tipo do cart√£o
  - Campo de validade com formata√ß√£o autom√°tica (MM/AA)
  - Layout horizontal (lado a lado)
- **Dispositivos**: Adicione m√∫ltiplos dispositivos com:
  - Campo para nome do dispositivo
  - Campo para n√∫mero de s√©rie
  - Layout horizontal (lado a lado)
- **Bot√µes de Adi√ß√£o/Remo√ß√£o**: Interface intuitiva com bot√µes "+" e "‚úï"
- **Formata√ß√£o Autom√°tica**: Campo de validade do cart√£o formata automaticamente para MM/AA
- **Dados Estruturados**: Armazenados em formato JSON para f√°cil manipula√ß√£o

### Gest√£o de Pagamentos
- **Tipo de Pagamento**: PIX ou Vale-presente
- **Campos Espec√≠ficos**:
  - N√∫mero do pedido
  - Valor do pedido
  - Valor vendido
- **Status do Vale**: Bot√µes visuais (Na Conta / Pendente)
- **Valor do Vale**: Campo num√©rico com valida√ß√£o

### Funcionalidades de Gerenciamento
- **Visualiza√ß√£o Minimizada**: Clientes aparecem com resumo (e-mail e valor do vale)
- **Ver Mais/Menos**: Expandir/recolher detalhes completos do cliente
- **Editar Cliente**: Carrega dados no quiz para edi√ß√£o
- **Remover Cliente**: Exclus√£o com confirma√ß√£o de seguran√ßa
- **Ordena√ß√£o**: Clientes mais recentes aparecem primeiro
- **Pagina√ß√£o**: Carrega dados em lotes para melhor performance (PostgreSQL)

### Melhorias de Seguran√ßa Implementadas
- ‚úÖ Corrigida vulnerabilidade XSS usando APIs DOM ao inv√©s de innerHTML
- ‚úÖ Valida√ß√£o e sanitiza√ß√£o de dados de entrada
- ‚úÖ Prote√ß√£o contra inje√ß√£o de c√≥digo em campos din√¢micos
- ‚úÖ Prepared statements para prevenir SQL Injection
- ‚úÖ Senhas hashadas com bcrypt (10 rounds)
- ‚úÖ Sessions HTTP-only cookies
- ‚úÖ Vari√°veis de ambiente para secrets
- ‚úÖ SSL em produ√ß√£o

## Depend√™ncias

### Produ√ß√£o
- express: ^4.18.2
- pg: ^8.16.3 (PostgreSQL)
- bcrypt: ^5.1.1
- express-session: ^1.17.3
- body-parser: ^1.20.2
- dotenv: ^17.2.3

### Desenvolvimento
- sqlite3: ^5.1.6 (desenvolvimento local)
- mongodb: ^6.3.0 (vers√£o Netlify)
- jsonwebtoken: ^9.0.2 (vers√£o Netlify)

## Deployment

### Replit (Desenvolvimento)
- Configurado para deployment em VM (necess√°rio para manter o estado do banco SQLite)
- O deployment usa Node.js sem build steps
- Custo: ~$30-45/m√™s (Replit Core + Reserved VM)

### Render (Produ√ß√£o - Recomendado)
- Configura√ß√£o autom√°tica via `render.yaml`
- PostgreSQL Starter ($7/m√™s) ou Free (90 dias)
- Web Service Free (com UptimeRobot) ou Starter ($7/m√™s)
- SSL autom√°tico e backups di√°rios
- **Custo total: $0-14/m√™s**
- üëâ [Ver guia completo](GUIA-RENDER.md)

### Netlify (Serverless)
- Backend convertido para Netlify Functions
- MongoDB Atlas (gr√°tis at√© 512 MB)
- Frontend est√°tico
- Leia: `README-NETLIFY.md` para instru√ß√µes

## Compara√ß√£o de Custos

| Plataforma | Custo/m√™s | Banco | Always-On | Backups | Melhor Para |
|------------|-----------|-------|-----------|---------|-------------|
| **Render** | **$0-7** | PostgreSQL | ‚úÖ (com ping) | ‚úÖ Di√°rio | **Produ√ß√£o** |
| Replit | $30-45 | PostgreSQL | ‚úÖ | ‚ö†Ô∏è Manual | Desenvolvimento |
| Railway | $5-10 | PostgreSQL | ‚úÖ | ‚úÖ | Alternativa |
| Netlify | $0 | MongoDB | ‚úÖ | ‚ùå | Serverless |

**Veredito:** Render oferece melhor custo-benef√≠cio para este projeto!

## Backup e Recupera√ß√£o de Dados

### Criar Backup Manual
```bash
node backup.js
```
- Gera arquivo JSON em `/backups/`
- Cont√©m TODOS os dados (users + clientes)
- Mostra estat√≠sticas completas
- Arquivo pode ser baixado e guardado

### Restaurar Backup
```bash
node restore.js backup_2025-01-15T10-30-00.json
```
- Limpa dados existentes
- Restaura backup completo
- Mostra progresso em tempo real
- Transa√ß√£o segura (rollback em caso de erro)

### Backup Autom√°tico (Render)
- **Render Starter DB**: Backups di√°rios autom√°ticos
- **Render Free DB**: Sem backups (use script manual)
- **Recomenda√ß√£o**: Rode `node backup.js` semanalmente

## Migra√ß√£o de Dados

### SQLite ‚Üí PostgreSQL
```bash
# 1. Configure .env com DATABASE_URL do PostgreSQL
DATABASE_URL=postgresql://usuario:senha@host/database

# 2. Execute migra√ß√£o
node migrate-to-postgres.js
```

**O script:**
- ‚úÖ Verifica dados no SQLite
- ‚úÖ Conecta no PostgreSQL
- ‚úÖ Migra usu√°rios e clientes
- ‚úÖ Mostra progresso detalhado
- ‚úÖ Garante zero perda de dados
- ‚úÖ Usa transa√ß√µes (rollback se falhar)

## Pr√≥ximos Passos Sugeridos

### Curto Prazo
1. ‚úÖ Deploy no Render (siga [GUIA-RENDER.md](GUIA-RENDER.md))
2. ‚úÖ Configurar UptimeRobot para ping gr√°tis
3. ‚úÖ Fazer backup manual ap√≥s migra√ß√£o
4. ‚úÖ Testar todos os endpoints

### M√©dio Prazo
1. Adicionar dom√≠nio personalizado
2. Configurar email de notifica√ß√µes (SendGrid/Mailgun)
3. Implementar sistema de m√∫ltiplos usu√°rios
4. Adicionar recupera√ß√£o de senha
5. Implementar relat√≥rios e estat√≠sticas

### Longo Prazo
1. Dashboard com gr√°ficos
2. Exporta√ß√£o para Excel/CSV
3. API RESTful completa
4. Aplicativo mobile (React Native)
5. Integra√ß√£o com CRM/ERP

## Estrutura de Arquivos

```
üìÅ cliente-cadastro/
‚îú‚îÄ‚îÄ üìÑ server.js                    # Servidor SQLite (dev)
‚îú‚îÄ‚îÄ üìÑ server-postgres.js           # Servidor PostgreSQL (prod)
‚îú‚îÄ‚îÄ üìÑ migrate-to-postgres.js       # Script migra√ß√£o
‚îú‚îÄ‚îÄ üìÑ backup.js                    # Script backup
‚îú‚îÄ‚îÄ üìÑ restore.js                   # Script restaura√ß√£o
‚îú‚îÄ‚îÄ üìÑ render.yaml                  # Config Render
‚îú‚îÄ‚îÄ üìÑ .env.example                 # Template env vars
‚îú‚îÄ‚îÄ üìÑ GUIA-RENDER.md              # Guia deploy Render
‚îú‚îÄ‚îÄ üìÑ README.md                    # Documenta√ß√£o
‚îú‚îÄ‚îÄ üìÑ replit.md                    # Este arquivo
‚îú‚îÄ‚îÄ üìÑ package.json                 # Depend√™ncias
‚îú‚îÄ‚îÄ üìÑ .gitignore                   # Git ignore
‚îú‚îÄ‚îÄ üìÅ public/                      # Frontend
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ index.html               # Interface
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ style.css                # Estilos
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ script.js                # L√≥gica
‚îú‚îÄ‚îÄ üìÅ netlify/                     # Vers√£o Netlify
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ functions/               # Serverless
‚îú‚îÄ‚îÄ üìÅ backups/                     # Backups (criada auto)
‚îî‚îÄ‚îÄ üìÑ database.db                  # SQLite (dev)
```

## Suporte e Documenta√ß√£o

### Documenta√ß√£o Completa
- **Deploy Render**: [GUIA-RENDER.md](GUIA-RENDER.md) - Guia passo a passo
- **README**: [README.md](README.md) - Instru√ß√µes gerais
- **Netlify**: [README-NETLIFY.md](README-NETLIFY.md) - Deploy serverless

### Solu√ß√£o de Problemas
- Verifique logs no Render Dashboard
- Confira vari√°veis de ambiente (.env)
- Teste scripts de backup/restore
- Consulte se√ß√£o "Solu√ß√£o de Problemas" no [GUIA-RENDER.md](GUIA-RENDER.md)

### Links √öteis
- Render Docs: https://render.com/docs
- PostgreSQL Docs: https://www.postgresql.org/docs/
- UptimeRobot: https://uptimerobot.com

---

**Desenvolvido com ‚ù§Ô∏è para gest√£o profissional de clientes**

üåü **Sistema 100% pronto para produ√ß√£o com garantia de zero perda de dados!**
